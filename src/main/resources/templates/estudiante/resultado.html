<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Resultado Saber Pro</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .nivel-1 { background-color: #DC3545 !important; color: white; }
        .nivel-2 { background-color: #FFC107 !important; color: black; }
        .nivel-3 { background-color: #17A2B8 !important; color: white; }
        .nivel-4 { background-color: #28A745 !important; color: white; }
        .puntaje-bajo { color: #DC3545; }
        .puntaje-medio { color: #FFC107; }
        .puntaje-alto { color: #28A745; }
        .alerta-perdio {
            background-color: #F8D7DA;
            border: 2px solid #DC3545;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }
        .alerta-perdio h2 {
            color: #DC3545;
            margin-bottom: 10px;
        }
        .btn-icfes {
            background-color: #0B4A75;
            color: white;
            padding: 15px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        .btn-icfes:hover {
            background-color: #083554;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <a th:href="@{/estudiante/dashboard}" class="navbar-brand">üéì Sistema Saber Pro UTS</a>
            <ul class="navbar-menu">
                <li><a th:href="@{/estudiante/dashboard}">Dashboard</a></li>
                <li><a th:href="@{/estudiante/buscar}">Buscar Resultado</a></li>
                <li><a th:href="@{/estudiante/resultados/todos}">Todos los Resultados</a></li>
            </ul>
            <div class="navbar-user">
                <span>üë§ <span th:text="${usuarioNombre}">Usuario</span></span>
                <a th:href="@{/logout}" class="btn-logout">Cerrar Sesi√≥n</a>
            </div>
        </div>
    </nav>

    <main class="container">
        <h1 class="mt-4 mb-4" style="color: #0B4A75;">üìä Resultado Saber Pro</h1>

        <!-- Informaci√≥n del Alumno -->
        <div class="card">
            <div class="card-header">üë§ Informaci√≥n del Estudiante</div>
            <p><strong>Nombre:</strong> <span th:text="${alumno.nombreCompleto}">Nombre</span></p>
            <p><strong>Documento:</strong> <span th:text="${alumno.numeroDocumento}">123456</span></p>
            <p><strong>Registro ICFES:</strong> <span th:text="${alumno.numeroRegistro}">EK123456</span></p>
        </div>

        <!-- ALERTA: Examen Anulado -->
        <div th:if="${resultado.estadoExamen.name() == 'ANULADO'}" class="alerta-perdio">
            <h2>‚ö†Ô∏è EXAMEN ANULADO</h2>
            <p style="font-size: 1.1rem;">Este examen fue anulado por no completar todas las sesiones.</p>
            <p>Debes presentar nuevamente el examen Saber Pro.</p>
            <a href="https://www.icfes.gov.co" target="_blank" class="btn-icfes">
                üìù Ir al ICFES para inscribirte nuevamente
            </a>
        </div>

        <!-- ALERTA: Perdi√≥ el Saber (menor a 80) -->
        <div th:if="${resultado.estadoExamen.name() != 'ANULADO' && resultado.puntajeSaberPro != null && resultado.puntajeSaberPro < 80}" class="alerta-perdio">
            <h2>‚ùå ¬°PERDISTE EL SABER PRO!</h2>
            <p style="font-size: 1.2rem; font-weight: bold;">Tu puntaje: <span th:text="${resultado.puntajeSaberPro}">0</span> puntos</p>
            <p style="font-size: 1.1rem;">Obtuviste un puntaje menor a 80 puntos.</p>
            <p style="color: #DC3545; font-weight: bold;">NO PUEDES GRADUARTE. Debes presentar nuevamente el examen.</p>
            <a href="https://www.icfes.gov.co" target="_blank" class="btn-icfes">
                üìù Ir al ICFES para inscribirte nuevamente
            </a>
        </div>

        <!-- ALERTA: Puntaje bajo (80-119) -->
        <div th:if="${resultado.estadoExamen.name() != 'ANULADO' && resultado.puntajeSaberPro != null && resultado.puntajeSaberPro >= 80 && resultado.puntajeSaberPro < 120}" class="card" style="border: 2px solid #FFC107;">
            <div class="alert alert-warning">
                <h3>‚ö†Ô∏è Puntaje Insuficiente para Beneficios</h3>
                <p>Tu puntaje de <strong th:text="${resultado.puntajeSaberPro}">0</strong> puntos no alcanza el m√≠nimo de 120 para obtener beneficios.</p>
                <p>Puedes presentar nuevamente para mejorar tu puntaje.</p>
                <a href="https://www.icfes.gov.co" target="_blank" class="btn-icfes">
                    üìù Ir al ICFES para mejorar tu puntaje
                </a>
            </div>
        </div>

        <!-- Puntaje General (solo si no es anulado) -->
        <div class="card" th:if="${resultado.estadoExamen.name() != 'ANULADO'}">
            <div class="card-header">üéØ Puntaje General</div>
            <div class="text-center">
                <div style="font-size: 4rem; font-weight: bold;" 
                     th:classappend="${resultado.puntajeSaberPro < 80 ? 'puntaje-bajo' : (resultado.puntajeSaberPro < 120 ? 'puntaje-medio' : 'puntaje-alto')}"
                     th:text="${resultado.puntajeSaberPro}">200</div>
                <div style="font-size: 1.5rem; margin-top: 1rem;">
                    <span class="badge" 
                          th:classappend="${resultado.nivelSaberPro == 'Nivel 4' ? 'nivel-4' : (resultado.nivelSaberPro == 'Nivel 3' ? 'nivel-3' : (resultado.nivelSaberPro == 'Nivel 2' ? 'nivel-2' : 'nivel-1'))}"
                          th:text="${resultado.nivelSaberPro}">Nivel</span>
                    <span class="badge" 
                          th:classappend="${resultado.estadoExamen.name() == 'APROBADO' ? 'badge-success' : 'badge-danger'}"
                          th:text="${resultado.estadoExamen}">Estado</span>
                </div>
            </div>
        </div>

        <!-- Resultados por Competencia (solo si no es anulado) -->
        <div class="card" th:if="${resultado.estadoExamen.name() != 'ANULADO'}">
            <div class="card-header">üìà Resultados por Competencia</div>
            <table class="table">
                <thead>
                    <tr>
                        <th>Competencia</th>
                        <th>Puntaje</th>
                        <th>Nivel</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Comunicaci√≥n Escrita</td>
                        <td th:text="${resultado.puntajeComunicacionEscrita}">0</td>
                        <td><span class="badge" 
                             th:classappend="${resultado.nivelComunicacionEscrita == 'Nivel 4' ? 'nivel-4' : (resultado.nivelComunicacionEscrita == 'Nivel 3' ? 'nivel-3' : (resultado.nivelComunicacionEscrita == 'Nivel 2' ? 'nivel-2' : 'nivel-1'))}"
                             th:text="${resultado.nivelComunicacionEscrita}">Nivel</span></td>
                    </tr>
                    <tr>
                        <td>Razonamiento Cuantitativo</td>
                        <td th:text="${resultado.puntajeRazonamientoCuantitativo}">0</td>
                        <td><span class="badge" 
                             th:classappend="${resultado.nivelRazonamientoCuantitativo == 'Nivel 4' ? 'nivel-4' : (resultado.nivelRazonamientoCuantitativo == 'Nivel 3' ? 'nivel-3' : (resultado.nivelRazonamientoCuantitativo == 'Nivel 2' ? 'nivel-2' : 'nivel-1'))}"
                             th:text="${resultado.nivelRazonamientoCuantitativo}">Nivel</span></td>
                    </tr>
                    <tr>
                        <td>Lectura Cr√≠tica</td>
                        <td th:text="${resultado.puntajeLecturaCritica}">0</td>
                        <td><span class="badge" 
                             th:classappend="${resultado.nivelLecturaCritica == 'Nivel 4' ? 'nivel-4' : (resultado.nivelLecturaCritica == 'Nivel 3' ? 'nivel-3' : (resultado.nivelLecturaCritica == 'Nivel 2' ? 'nivel-2' : 'nivel-1'))}"
                             th:text="${resultado.nivelLecturaCritica}">Nivel</span></td>
                    </tr>
                    <tr>
                        <td>Competencias Ciudadanas</td>
                        <td th:text="${resultado.puntajeCompetenciasCiudadanas}">0</td>
                        <td><span class="badge" 
                             th:classappend="${resultado.nivelCompetenciasCiudadanas == 'Nivel 4' ? 'nivel-4' : (resultado.nivelCompetenciasCiudadanas == 'Nivel 3' ? 'nivel-3' : (resultado.nivelCompetenciasCiudadanas == 'Nivel 2' ? 'nivel-2' : 'nivel-1'))}"
                             th:text="${resultado.nivelCompetenciasCiudadanas}">Nivel</span></td>
                    </tr>
                    <tr>
                        <td>Ingl√©s</td>
                        <td th:text="${resultado.puntajeIngles}">0</td>
                        <td>
                            <span class="badge" 
                                 th:classappend="${resultado.nivelIngles == 'Nivel 4' ? 'nivel-4' : (resultado.nivelIngles == 'Nivel 3' ? 'nivel-3' : (resultado.nivelIngles == 'Nivel 2' ? 'nivel-2' : 'nivel-1'))}"
                                 th:text="${resultado.nivelIngles}">Nivel</span>
                            <span class="badge badge-success" th:text="${resultado.nivelInglesCEFR}">CEFR</span>
                        </td>
                    </tr>
                    <tr>
                        <td>Formulaci√≥n de Proyectos</td>
                        <td th:text="${resultado.puntajeFormulacionProyectos}">0</td>
                        <td><span class="badge" 
                             th:classappend="${resultado.nivelFormulacionProyectos == 'Nivel 4' ? 'nivel-4' : (resultado.nivelFormulacionProyectos == 'Nivel 3' ? 'nivel-3' : (resultado.nivelFormulacionProyectos == 'Nivel 2' ? 'nivel-2' : 'nivel-1'))}"
                             th:text="${resultado.nivelFormulacionProyectos}">Nivel</span></td>
                    </tr>
                    <tr>
                        <td>Pensamiento Cient√≠fico</td>
                        <td th:text="${resultado.puntajePensamientoCientifico}">0</td>
                        <td><span class="badge" 
                             th:classappend="${resultado.nivelPensamientoCientifico == 'Nivel 4' ? 'nivel-4' : (resultado.nivelPensamientoCientifico == 'Nivel 3' ? 'nivel-3' : (resultado.nivelPensamientoCientifico == 'Nivel 2' ? 'nivel-2' : 'nivel-1'))}"
                             th:text="${resultado.nivelPensamientoCientifico}">Nivel</span></td>
                    </tr>
                    <tr>
                        <td>Dise√±o de Software</td>
                        <td th:text="${resultado.puntajeDisenoSoftware}">0</td>
                        <td><span class="badge" 
                             th:classappend="${resultado.nivelDisenoSoftware == 'Nivel 4' ? 'nivel-4' : (resultado.nivelDisenoSoftware == 'Nivel 3' ? 'nivel-3' : (resultado.nivelDisenoSoftware == 'Nivel 2' ? 'nivel-2' : 'nivel-1'))}"
                             th:text="${resultado.nivelDisenoSoftware}">Nivel</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Beneficios (solo si aprob√≥ con beneficios) -->
        <div class="card" th:if="${resultado.estadoExamen.name() != 'ANULADO' && resultado.puntajeSaberPro != null && resultado.puntajeSaberPro >= 120}">
            <div class="card-header">üéÅ Beneficios Obtenidos</div>
            <div class="alert alert-success">
                <h3>‚úÖ ¬°Felicitaciones! Tienes beneficios</h3>
                <p th:text="${resultado.descripcionBeneficio}">Descripci√≥n</p>
                <p th:if="${resultado.notaTrabajoGrado != null}">
                    <strong>Nota asignada trabajo de grado:</strong> 
                    <span style="font-size: 1.5rem; font-weight: bold; color: #28A745;" th:text="${resultado.notaTrabajoGrado}">5.0</span>
                </p>
                <p th:if="${resultado.porcentajeBecaDerechosGrado > 0}">
                    <strong>Beca derechos de grado:</strong> 
                    <span style="font-size: 1.5rem; font-weight: bold; color: #0B4A75;" th:text="${resultado.porcentajeBecaDerechosGrado + '%'}">100%</span>
                </p>
            </div>
        </div>

        <div class="mt-3">
            <a th:href="@{/estudiante/buscar}" class="btn btn-primary">‚Üê Volver a Buscar</a>
            <a th:href="@{/estudiante/dashboard}" class="btn btn-secondary">Ir al Dashboard</a>
        </div>
    </main>
</body>
</html>